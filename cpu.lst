


ARM Macro Assembler    Page 1 


    1 00000000         
    2 00000000                 EXPORT           IE_vGeneratePendSV
    3 00000000                 EXTERN           g_pstCurTask
    4 00000000                 EXTERN           g_pstHighTask
    5 00000000                 EXPORT           PendSV_Handler
    6 00000000                 EXPORT           IE_syDisable
    7 00000000                 EXPORT           IE_vSet
    8 00000000                 EXPORT           IE_vGenerateFirstPendSV
    9 00000000 E000ED04 
                       NVIC_INT_CTRL
                               EQU              0xE000ED04  ; Interrupt control
                                                             state register
   10 00000000 10000000 
                       NVIC_PENDSVSET
                               EQU              0x10000000  ; Value to trigger 
                                                            PendSV exception
   11 00000000 E000ED22 
                       NVIC_SYSPRI14
                               EQU              0xE000ED22
   12 00000000 000000FF 
                       NVIC_PENDSV_PRI
                               EQU              0xff
   13 00000000         
   14 00000000         
   15 00000000         
   16 00000000         
   17 00000000                 AREA             |.text|, CODE, READONLY, ALIGN=
2
   18 00000000                 THUMB
   19 00000000                 REQUIRE8
   20 00000000                 PRESERVE8
   21 00000000         
   22 00000000         __g_pstCurTask
   23 00000000 00000000        DCD              g_pstCurTask
   24 00000004         
   25 00000004         
   26 00000004         __g_pstHighTask
   27 00000004 00000000        DCD              g_pstHighTask
   28 00000008         
   29 00000008         
   30 00000008         
   31 00000008         IE_syDisable
   32 00000008 F3EF 8010       MRS              R0, PRIMASK
   33 0000000C B672            CPSID            I
   34 0000000E 4770            BX               LR
   35 00000010         
   36 00000010         IE_vSet
   37 00000010 F380 8810       MSR              PRIMASK, R0
   38 00000014 4770            BX               LR
   39 00000016         
   40 00000016         IE_vGenerateFirstPendSV
   41 00000016         
   42 00000016 2000            MOVS             R0, #0      ; Set the PSP to 0 
                                                            for initial context
                                                             switch call
   43 00000018 F380 8809       MSR              PSP, R0
   44 0000001C         
   45 0000001C 4815            LDR              R0, =NVIC_INT_CTRL ; Trigger th
                                                            e PendSV exception 



ARM Macro Assembler    Page 2 


                                                            (causes context swi
                                                            tch)
   46 0000001E F04F 5180       LDR              R1, =NVIC_PENDSVSET
   47 00000022 6001            STR              R1, [R0]
   48 00000024         
   49 00000024 4770            BX               LR
   50 00000026         
   51 00000026         ; Use this code to generate a PendSV interrupt, 
   52 00000026         ;  The PendSV interrupt will be pushed forward after any
                        other interrupt arises. 
   53 00000026         
   54 00000026         
   55 00000026 4813            LDR              R0, =NVIC_INT_CTRL ; Trigger th
                                                            e PendSV exception 
                                                            (causes context swi
                                                            tch)
   56 00000028 F04F 5180       LDR              R1, =NVIC_PENDSVSET
   57 0000002C 6001            STR              R1, [R0]
   58 0000002E 4770            BX               LR
   59 00000030         
   60 00000030         PendSV_Handler
   61 00000030         ;CLZ  R4, R0
   62 00000030 F3EF 8009       MRS              R0, PSP     ; PSP is process st
                                                            ack pointer
   63 00000034 B130            CBZ              R0, OSPendSV_nosave ; skip regi
                                                            ster save the first
                                                             time
   64 00000036 3820            SUBS             R0, R0, #0x20 ; save remaining 
                                                            regs r4-11 on proce
                                                            ss stack
   65 00000038 E880 0FF0       STM              R0, {R4-R11}
   66 0000003C F85F 1040       LDR              R1, __g_pstCurTask ;           
                                                                               
                                                                   ; OSTCBCur->
                                                            OSTCBStkPtr = SP;
   67 00000040 6809            LDR              R1, [R1]
   68 00000042 6008            STR              R0, [R1]
   69 00000044         
   70 00000044         
   71 00000044         
   72 00000044         
   73 00000044         OSPendSV_nosave
   74 00000044 F85F 0048       LDR              R0, __g_pstCurTask ; OSTCBCur  
                                                            = OSTCBHighRdy;
   75 00000048 F85F 1048       LDR              R1, __g_pstHighTask
   76 0000004C 680A            LDR              R2, [R1]
   77 0000004E 6002            STR              R2, [R0]
   78 00000050 6810            LDR              R0, [R2]    ; R0 is new process
                                                             SP; SP = OSTCBHigh
                                                            Rdy->OSTCBStkPtr;
   79 00000052 E890 0FF0       LDM              R0, {R4-R11} ; restore r4-11 fr
                                                            om new process stac
                                                            k
   80 00000056 3020            ADDS             R0, R0, #0x20
   81 00000058 F380 8809       MSR              PSP, R0     ; load PSP with new
                                                             process SP
   82 0000005C F04E 0E04       ORR              LR, LR, #0x04 ; ensure exceptio
                                                            n return uses proce
                                                            ss stack



ARM Macro Assembler    Page 3 


   83 00000060         ;MSR     PRIMASK, R3  ;                                 
                                     ; exception return will restore remaining 
                       context
   84 00000060 4770            BX               LR
   85 00000062         
   86 00000062         IE_vGeneratePendSV
   87 00000062 4805            LDR              R0,=NVIC_SYSPRI14
   88 00000064 F04F 01FF       LDR              R1,=NVIC_PENDSV_PRI
   89 00000068 7001            STRB             R1, [R0]    ;?¥•∑¢PendSV“Ï≥£
   90 0000006A 4802            LDR              R0, =NVIC_INT_CTRL ; Trigger th
                                                            e PendSV exception 
                                                            (causes context swi
                                                            tch)
   91 0000006C F04F 5180       LDR              R1, =NVIC_PENDSVSET
   92 00000070 6001            STR              R1, [R0]
   93 00000072 4770            BX               LR
   94 00000074         
   95 00000074                 END
              E000ED04 
              E000ED22 
Command Line: --debug --xref --cpu=Cortex-M3 --apcs=interwork --depend=.\obj\cp
u.d -o.\obj\cpu.o -Id:\Keil\ARM\RV31\INC -Id:\Keil\ARM\CMSIS\Include -Id:\Keil\
ARM\Inc\ST\STM32F10x --predefine="__EVAL SETA 1" --list=.\cpu.lst CM3\CPU.S



ARM Macro Assembler    Page 1 Alphabetic symbol ordering
Relocatable symbols

.text 00000000

Symbol: .text
   Definitions
      At line 17 in file CM3\CPU.S
   Uses
      None
Comment: .text unused
IE_syDisable 00000008

Symbol: IE_syDisable
   Definitions
      At line 31 in file CM3\CPU.S
   Uses
      At line 6 in file CM3\CPU.S
Comment: IE_syDisable used once
IE_vGenerateFirstPendSV 00000016

Symbol: IE_vGenerateFirstPendSV
   Definitions
      At line 40 in file CM3\CPU.S
   Uses
      At line 8 in file CM3\CPU.S
Comment: IE_vGenerateFirstPendSV used once
IE_vGeneratePendSV 00000062

Symbol: IE_vGeneratePendSV
   Definitions
      At line 86 in file CM3\CPU.S
   Uses
      At line 2 in file CM3\CPU.S
Comment: IE_vGeneratePendSV used once
IE_vSet 00000010

Symbol: IE_vSet
   Definitions
      At line 36 in file CM3\CPU.S
   Uses
      At line 7 in file CM3\CPU.S
Comment: IE_vSet used once
OSPendSV_nosave 00000044

Symbol: OSPendSV_nosave
   Definitions
      At line 73 in file CM3\CPU.S
   Uses
      At line 63 in file CM3\CPU.S
Comment: OSPendSV_nosave used once
PendSV_Handler 00000030

Symbol: PendSV_Handler
   Definitions
      At line 60 in file CM3\CPU.S
   Uses
      At line 5 in file CM3\CPU.S
Comment: PendSV_Handler used once
__g_pstCurTask 00000000

Symbol: __g_pstCurTask



ARM Macro Assembler    Page 2 Alphabetic symbol ordering
Relocatable symbols

   Definitions
      At line 22 in file CM3\CPU.S
   Uses
      At line 66 in file CM3\CPU.S
      At line 74 in file CM3\CPU.S

__g_pstHighTask 00000004

Symbol: __g_pstHighTask
   Definitions
      At line 26 in file CM3\CPU.S
   Uses
      At line 75 in file CM3\CPU.S
Comment: __g_pstHighTask used once
9 symbols



ARM Macro Assembler    Page 1 Alphabetic symbol ordering
Absolute symbols

NVIC_INT_CTRL E000ED04

Symbol: NVIC_INT_CTRL
   Definitions
      At line 9 in file CM3\CPU.S
   Uses
      At line 45 in file CM3\CPU.S
      At line 55 in file CM3\CPU.S
      At line 90 in file CM3\CPU.S

NVIC_PENDSVSET 10000000

Symbol: NVIC_PENDSVSET
   Definitions
      At line 10 in file CM3\CPU.S
   Uses
      At line 46 in file CM3\CPU.S
      At line 56 in file CM3\CPU.S
      At line 91 in file CM3\CPU.S

NVIC_PENDSV_PRI 000000FF

Symbol: NVIC_PENDSV_PRI
   Definitions
      At line 12 in file CM3\CPU.S
   Uses
      At line 88 in file CM3\CPU.S
Comment: NVIC_PENDSV_PRI used once
NVIC_SYSPRI14 E000ED22

Symbol: NVIC_SYSPRI14
   Definitions
      At line 11 in file CM3\CPU.S
   Uses
      At line 87 in file CM3\CPU.S
Comment: NVIC_SYSPRI14 used once
4 symbols



ARM Macro Assembler    Page 1 Alphabetic symbol ordering
External symbols

g_pstCurTask 00000000

Symbol: g_pstCurTask
   Definitions
      At line 3 in file CM3\CPU.S
   Uses
      At line 23 in file CM3\CPU.S
Comment: g_pstCurTask used once
g_pstHighTask 00000000

Symbol: g_pstHighTask
   Definitions
      At line 4 in file CM3\CPU.S
   Uses
      At line 27 in file CM3\CPU.S
Comment: g_pstHighTask used once
2 symbols
348 symbols in table
